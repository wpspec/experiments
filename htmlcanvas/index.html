<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML canvas grid</title>
  <style>
    canvas {
      border: 1px solid #000;
    }

    #infoContainer {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <canvas id="gridCanvas" width="250" height="250"></canvas>
  <div id="infoContainer">
    <p id="killsCounter">Kills: 0</p>
    <button id="toggleMovementButton">Toggle Movement</button>
    <button id="toggleSensingButton">Sense</button>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {

      var canvas = document.getElementById('gridCanvas');
      var ctx = canvas.getContext('2d');
      var cellSize = 50;

      var playerX = 2;
      var playerY = 2;

      var enemyX;
      var enemyY;

      var enemyKills = 0;
      var isPlayerMoving = false;
      var isSensing = false;

      function drawGrid() {
        for (var x = 0; x <= canvas.width; x += cellSize) {
          ctx.moveTo(x, 0);
          ctx.lineTo(x, canvas.height);
        }

        for (var y = 0; y <= canvas.height; y += cellSize) {
          ctx.moveTo(0, y);
          ctx.lineTo(canvas.width, y);
        }

        ctx.strokeStyle = "#000";
        ctx.stroke();
      }

      function drawPlayer() {
        var playerPosX = playerX * cellSize + cellSize / 4;
        var playerPosY = playerY * cellSize + cellSize / 4;
        var playerSize = cellSize / 2;

        ctx.fillStyle = "blue";
        ctx.fillRect(playerPosX, playerPosY, playerSize, playerSize);

        ctx.fillStyle = "#000"; // Black color
        ctx.font = "12px Arial";
        ctx.fillText("PL", playerPosX + playerSize / 4, playerPosY + playerSize / 2 + 5);
      }

      function drawEnemy() {
        var enemyPosX = enemyX * cellSize + cellSize / 4;
        var enemyPosY = enemyY * cellSize + cellSize / 4;
        var enemySize = cellSize / 2;

        ctx.fillStyle = "red";
        ctx.fillRect(enemyPosX, enemyPosY, enemySize, enemySize);
      }

      function drawCounter() {
        var counterElement = document.getElementById('killsCounter');
        counterElement.textContent = "Kills: " + enemyKills;
      }

      function generateRandomPosition() {
        enemyX = Math.floor(Math.random() * 5);
        enemyY = Math.floor(Math.random() *5);
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGrid();
        drawPlayer();
        drawEnemy();
        drawCounter();
      }

      function respawnEnemy() {
        enemyKills++;
        generateRandomPosition();
        draw();
      }

      function movePlayerRandomly() {
        if (isPlayerMoving) {

          var randomDirection = Math.floor(Math.random() * 4);

          switch (randomDirection) {
            case 0:
              playerX = Math.min(4, playerX + 1);
              break;
            case 1:
              playerX = Math.max(0, playerX - 1);
              break;
            case 2:
              playerY = Math.min(4, playerY + 1);
              break;
            case 3:
              playerY = Math.max(0, playerY - 1);
              break;
          }

          if (playerX === enemyX && playerY === enemyY) {
            respawnEnemy();
          }

          if (isSensing) {
            senseAndMove();
          }

          draw();

          setTimeout(movePlayerRandomly, 500);

        }          
      }

      function senseAndMove() {
        var enemyLeft = playerX > 0 && playerX - 1 === enemyX && playerY === enemyY;
        var enemyRight = playerX < 4 && playerX + 1 === enemyX && playerY === enemyY;
        var enemyUp = playerY > 0 && playerX === enemyX && playerY - 1 === enemyY;
        var enemyDown = playerY < 4 && playerX === enemyY && playerY + 1 === enemyY;

        if (enemyLeft) {
          playerX = Math.max(0, playerX - 1);
        } else if (enemyRight) {
          playerX = Math.min(4, playerX + 1);
        } else if (enemyUp) {
          playerY = Math.max(0, playerY - 1);
        } else if (enemyDown) {
          playerY = Math.min(4, playerY + 1);
        }
      }

      function togglePlayerMovement() {
        isPlayerMoving = !isPlayerMoving;

        if (isPlayerMoving) {
          movePlayerRandomly();
        }
      }

      function toggleSensing() {
        isSensing = !isSensing;
        console.log(isSensing)
      }

      generateRandomPosition();
      draw();

      var toggleMovementButton = document.getElementById('toggleMovementButton');
      toggleMovementButton.addEventListener('click', togglePlayerMovement);

      var toggleSensingButton = document.getElementById('toggleSensingButton');
      toggleSensingButton.addEventListener('click', toggleSensing);
    });
  </script>
</body>
</html>